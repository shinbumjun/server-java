# 이커머스 API 요구사항

## 1️⃣ 주요 잔액 충전 / 조회 API

- **잔액 충전 API**  
  결제에 사용될 금액을 충전하는 API를 작성합니다.
    - **POST** `/api/v1/points/{userId}`
    - **입력값**: 사용자 ID, 충전 금액
    - **입력값 검사**:
        - 사용자 ID가 유효한지(음수가 아닌지)
        - 해당 사용자 ID에 맞는 실제 사용자 존재 여부 확인
        - 충전 금액이 음수가 아닌지 확인
        - 충전 금액은 1회 최대 1,000,000원
        - 누적 금액은 최대 5,000,000원
    - **충전 이력 저장**
    - **충전 완료**

- **잔액 조회 API**  
  사용자 식별자를 통해 해당 사용자의 잔액을 조회합니다.
    - **GET** `/api/v1/points/{userId}`
    - **입력값**: 사용자 ID
    - **입력값 검증**: 사용자 ID에 따른 유저가 실제 존재하는지 확인. 없을 시 Exception 발생.
    - **포인트 조회**

## 2️⃣ 기본 상품 조회 API

- 상품 정보를 조회하는 API를 작성합니다.
    - **GET** `/api/v1/products`
    - **정보**: 상품 ID, 이름, 가격, 잔여 수량
    - **페이징**: 필요시 `cursor` 또는 `offset` 사용
    - **잔여 수량 정확성**: 조회 시점의 상품별 잔여 수량 정확히 반영

## 3️⃣ 주요 선착순 쿠폰 기능

- **보유 쿠폰 목록 조회 API**  
  사용자는 보유 쿠폰 목록을 조회할 수 있습니다.
    - **GET** `/api/v1/coupons?userId={userId}`

- **선착순 쿠폰 발급 API**  
  사용자는 선착순으로 할인 쿠폰을 발급받을 수 있습니다.
    - **POST** `/api/v1/coupons/{couponId}/issue`
    - **검증**:
        - couponID에 따른 쿠폰 존재 여부
        - 잔여 수량(remain_amount)이 0이라면 발급 실패
        - 한 사용자당 1회만 발급 가능
        - 발급 수량이 남아있다면 쿠폰 발급 성공
    - **발급 완료 후 잔여 수량 차감**

## 4️⃣ 주요 주문 / 결제 API

- **주문 API**  
  사용자 식별자와 쿠폰 ID, (상품 ID, 수량) 목록을 입력받아 주문을 생성합니다.
    - **POST** `/api/v1/orders`
    - **입력값 검증**:
        - 사용자 ID 검증
        - 상품 ID 검증
        - 수량 검증
        - 재고 초과 시 주문 실패 처리

- **쿠폰 적용**
    - 쿠폰 ID 검증 (사용자가 보유한 쿠폰인지)
    - 쿠폰의 유효기간 및 적용 정책 확인
    - 할인된 주문 금액 반환
    - 쿠폰 상태 변경 (`is_used = true`)

- **주문 상태 관리**
    - 주문 상태 (`orders_status`)를 **NOT_PAID**로 설정
    - 5분 이내 결제 미완료 시 주문 상태를 **FAILED**로 변경
    - 재고 및 쿠폰 롤백

- **결제 API**  
  사용자 식별자와 주문 ID를 받아 결제를 진행합니다.
    - **POST** `/api/v1/payments`
    - **입력값 검증**: 사용자 ID, 주문 ID 검증
    - **포인트 조회**: 사용자의 보유 포인트가 결제 금액보다 적으면 결제 실패 처리
    - **포인트 차감 및 차감 이력 저장**
    - **결제 완료 후 주문 상태 `PAID`로 변경**
    - **주문 정보 데이터 플랫폼 전송**
    - **데이터 플랫폼 전송 실패 시 롤백 처리**

## 5️⃣ 기본 상위 상품 조회 API

- **인기 상품 조회 API**  
  최근 3일간 가장 많이 팔린 5개 상품을 조회합니다.
    - **GET** `/api/v1/products/best`
    - **스케줄러**: 매일 00시에 실행
